<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silence</title>
    <script src="js/utils/utils.js"></script>
    <script src="js/utils/vector.js"></script>
    <script src="js/utils/particle.js"></script>
    <script src="js/src/ui-animation.js"></script>
    <link rel="stylesheet" href="css/core.css"/>
</head>
<body>
<ul>
    <li>Spotify <button class="button animated">Install</button><canvas class="canvas-loader" width="40" height="40"></canvas></li>
    <li>Evernote <button class="button animated">Install</button><canvas class="canvas-loader" width="40" height="40"></canvas></li>
</ul>

<script type="text/javascript">
    
    document.addEventListener("click", function (evt) {
        evt.preventDefault();
        var elem = evt.target; 
        if (elem.tagName === "BUTTON") {
            elem.classList.add("slideOutRight");
            window.setTimeout(function () {
                var loader = elem.parentNode.querySelector("canvas");
                loader.classList.add("slideInRight");
                var obj = objs[loader.getAttribute("index")];
                obj.start();
                window.setTimeout(function () {
                    setLoading(obj);
                }, 300);
            }, 200);
        }
    });
    
    var objs = [];

    getElements(".canvas-loader");

    function setLoading(obj) {
        /**
         * Fake Loader
         */
        var int = window.setInterval(function () {
            if (obj.loaded) {
                clearInterval(int);
            } else {
                obj.update(obj.progress + 0.01);
            }
        }, 50);
    }

    /**
     * @param selector
     */
    function getElements (selector) {
        [].forEach.call(document.querySelectorAll(selector), function (elem, i) {
            elem.setAttribute("index", i);
            var loader = new window.Loader(elem);
            objs.push(loader);
        });
    }
</script>
</body>
</html>